<?xml version="1.0" encoding="UTF-8"?>
<itop_design xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="3.1" load="strict">
    <classes>
        <class id="PNObject" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <php_parent>
                <name>TeemIp\TeemIp\Extension\Framework\Model\_PNAbstractObject</name>
            </php_parent>
            <properties>
                <comment/>
                <category>bizmodel,pnmgmt</category>
                <abstract>true</abstract>
                <key_type>autoincrement</key_type>
                <db_table>pnobject</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field>finalclass</db_final_class_field>
                <naming>
                    <attributes/>
                </naming>
                <icon/>
                <reconciliation>
                    <attributes>
                        <attribute id=""/>
                    </attributes>
                </reconciliation>
            </properties>
            <fields>
                <field id="org_id" xsi:type="AttributeExternalKey">
                    <sql>org_id</sql>
                    <target_class>Organization</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                    <jointype/>
                </field>
                <field id="org_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>org_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="status" xsi:type="AttributeEnum">
                    <sort_type>rank</sort_type>
                    <values>
                        <value id="reserved">
                            <code>reserved</code>
                            <rank>10</rank>
                            <style>
                                <main_color>hsla(0, 60.8%, 48%, 1)</main_color>
                                <complementary_color>hsla(0, 0%, 100%, 1)</complementary_color>
                                <decoration_classes/>
                            </style>
                        </value>
                        <value id="allocated">
                            <code>allocated</code>
                            <rank>20</rank>
                            <style>
                                <main_color>hsla(207, 72.6%, 57.1%, 1)</main_color>
                                <complementary_color>hsla(0, 0%, 100%, 1)</complementary_color>
                                <decoration_classes/>
                            </style>
                        </value>
                        <value id="released">
                            <code>released</code>
                            <rank>30</rank>
                            <style>
                                <main_color>hsla(209, 23.7%, 74.3%, 1)</main_color>
                                <complementary_color>hsla(0, 0%, 100%, 1)</complementary_color>
                                <decoration_classes/>
                            </style>
                        </value>
                        <value id="unassigned">
                            <code>unassigned</code>
                            <rank>40</rank>
                            <style>
                                <main_color>hsla(88, 50.2%, 52.7%, 1)</main_color>
                                <complementary_color>hsla(0, 0%, 100%, 1)</complementary_color>
                                <decoration_classes/>
                            </style>
                        </value>
                    </values>
                    <default_style>
                        <main_color>hsla(88, 50.2%, 52.7%, 1)</main_color>
                        <complementary_color>hsla(0, 0%, 100%, 1)</complementary_color>
                        <decoration_classes/>
                    </default_style>
                    <sql>status</sql>
                    <default_value>allocated</default_value>
                    <is_null_allowed>false</is_null_allowed>
                </field>
                <field id="comment" xsi:type="AttributeText">
                    <sql>comment</sql>
                    <default_value/>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="requestor_id" xsi:type="AttributeExternalKey">
                    <filter><![CDATA[SELECT Person AS p WHERE p.org_id = :this->org_id]]></filter>
                    <dependencies>
                        <attribute id="org_id"/>
                    </dependencies>
                    <sql>requestor_id</sql>
                    <target_class>Person</target_class>
                    <is_null_allowed>true</is_null_allowed>
                    <on_target_delete>DEL_MANUAL</on_target_delete>
                    <jointype/>
                </field>
                <field id="requestor_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>requestor_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
                <field id="allocation_date" xsi:type="AttributeDateTime">
                    <sql>allocation_date</sql>
                    <default_value/>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="release_date" xsi:type="AttributeDateTime">
                    <sql>release_date</sql>
                    <default_value/>
                    <is_null_allowed>true</is_null_allowed>
                </field>
                <field id="contact_list" xsi:type="AttributeLinkedSetIndirect">
                    <linked_class>lnkContactToPNObject</linked_class>
                    <ext_key_to_me>pnobject_id</ext_key_to_me>
                    <count_min>0</count_min>
                    <count_max>0</count_max>
                    <ext_key_to_remote>contact_id</ext_key_to_remote>
                    <duplicates/>
                </field>
                <field id="document_list" xsi:type="AttributeLinkedSetIndirect">
                    <linked_class>lnkDocToPNObject</linked_class>
                    <ext_key_to_me>pnobject_id</ext_key_to_me>
                    <count_min>0</count_min>
                    <count_max>0</count_max>
                    <ext_key_to_remote>document_id</ext_key_to_remote>
                    <duplicates/>
                </field>
            </fields>
            <methods>
                <method id="ComputeValues">
                    <comment/>
                    <static>false</static>
                    <access>protected</access>
                    <type>Overload-cmdbAbstractObject</type>
                    <code><![CDATA[ public function ComputeValues()
 {
 		parent::ComputeValues();

		if ($this->IsNew()) {
			// Make sure IPConfig exists for the organization
			$iOrgId = $this->Get('org_id');
			if (($iOrgId != '') && ($this->Get('ipconfig_id') == '')) {
				$this->Set('ipconfig_id', IPConfig::GetGlobalIPConfig($iOrgId)->GetKey());
			}
		}
 }]]></code>
                </method>
                <method id="OnInsert">
                    <comment/>
                    <static>false</static>
                    <access>protected</access>
                    <type>Overload-cmdbAbstractObject</type>
                    <code><![CDATA[ public function OnInsert()
 {
		parent::OnInsert();

		// Set allocation and released date as required
		$sStatus = $this->Get('status');
		if ($sStatus == 'allocated') {
			$this->Set('allocation_date', time());
		} elseif ($sStatus== 'released') {
			$this->Set('release_date', time());
		}
 }]]></code>
                </method>
                <method id="OnUpdate">
                    <comment/>
                    <static>false</static>
                    <access>protected</access>
                    <type>Overload-cmdbAbstractObject</type>
                    <code><![CDATA[ public function OnUpdate()
 {
		parent::OnUpdate();

		// Set allocation and released date as required
		$sStatus = $this->Get('status');
		$soriginalStatus = $this->GetOriginal('status');
		if (($sStatus == 'allocated') && ($soriginalStatus != 'allocated')) {
			$this->Set('allocation_date', time());
		} elseif (($sStatus== 'released') && ($soriginalStatus != 'released')) {
			$this->Set('release_date', time());
		}
 }]]></code>
                </method>
            </methods>
            <presentation>
                <list>
                    <items>
                        <item id="finalclass">
                            <rank>10</rank>
                        </item>
                        <item id="org_id">
                            <rank>20</rank>
                        </item>
                        <item id="status">
                            <rank>30</rank>
                        </item>
                        <item id="requestor_id">
                            <rank>40</rank>
                        </item>
                        <item id="allocation_date">
                            <rank>50</rank>
                        </item>
                        <item id="release_date">
                            <rank>60</rank>
                        </item>
                    </items>
                </list>
                <default_search>
                    <items>
                        <item id="org_id">
                            <rank>10</rank>
                        </item>
                        <item id="status">
                            <rank>20</rank>
                        </item>
                        <item id="requestor_id">
                            <rank>30</rank>
                        </item>
                        <item id="allocation_date">
                            <rank>40</rank>
                        </item>
                        <item id="release_date">
                            <rank>50</rank>
                        </item>
                    </items>
                </default_search>
            </presentation>
        </class>
        <class id="lnkContactToPNObject" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <properties>
                <is_link>1</is_link>
                <category>bizmodel,pnmgmt</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>lnkcontacttopnobject</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field/>
                <naming>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="contact_name"/>
                    </attributes>
                </naming>
                <icon/>
                <reconciliation>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="contact_id"/>
                    </attributes>
                </reconciliation>
                <uniqueness_rules>
                    <rule id="no_duplicate">
                        <attributes>
                            <attribute id="pnobject_id"/>
                            <attribute id="contact_id"/>
                        </attributes>
                        <filter><![CDATA[]]></filter>
                        <disabled>false</disabled>
                        <is_blocking>true</is_blocking>
                    </rule>
                </uniqueness_rules>
            </properties>
            <fields>
                <field id="pnobject_id" xsi:type="AttributeExternalKey">
                    <sql>pnobject_id</sql>
                    <target_class>PNObject</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                    <jointype/>
                </field>
                <field id="contact_id" xsi:type="AttributeExternalKey">
                    <sql>contact_id</sql>
                    <target_class>Contact</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                    <jointype/>
                </field>
                <field id="contact_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>contact_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
            </fields>
            <methods/>
            <presentation>
                <details>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="contact_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </details>
                <search>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="contact_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </search>
                <list>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="contact_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </list>
            </presentation>
        </class>
        <class id="lnkDocToPNObject" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <properties>
                <is_link>1</is_link>
                <category>bizmodel,pnmgmt</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>lnkdoctoPNObject</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field/>
                <naming>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="document_name"/>
                    </attributes>
                </naming>
                <icon/>
                <reconciliation>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="document_id"/>
                    </attributes>
                </reconciliation>
                <uniqueness_rules>
                    <rule id="no_duplicate">
                        <attributes>
                            <attribute id="pnobject_id"/>
                            <attribute id="document_id"/>
                        </attributes>
                        <filter><![CDATA[]]></filter>
                        <disabled>false</disabled>
                        <is_blocking>true</is_blocking>
                    </rule>
                </uniqueness_rules>
            </properties>
            <fields>
                <field id="pnobject_id" xsi:type="AttributeExternalKey">
                    <sql>pnobject_id</sql>
                    <target_class>PNObject</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                    <jointype/>
                </field>
                <field id="document_id" xsi:type="AttributeExternalKey">
                    <sql>document_id</sql>
                    <target_class>Document</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                    <jointype/>
                </field>
                <field id="document_name" xsi:type="AttributeExternalField">
                    <extkey_attcode>document_id</extkey_attcode>
                    <target_attcode>name</target_attcode>
                </field>
            </fields>
            <methods/>
            <presentation>
                <details>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="document_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </details>
                <search>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="document_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </search>
                <list>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="document_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </list>
            </presentation>
        </class>
        <class id="lnkPNObjectToTicket" _delta="define">
            <parent>cmdbAbstractObject</parent>
            <properties>
                <is_link>1</is_link>
                <category>bizmodel</category>
                <abstract>false</abstract>
                <key_type>autoincrement</key_type>
                <db_table>lnkPNObjecttoticket</db_table>
                <db_key_field>id</db_key_field>
                <db_final_class_field/>
                <naming>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="ticket_ref"/>
                    </attributes>
                </naming>
                <icon/>
                <reconciliation>
                    <attributes>
                        <attribute id="pnobject_id"/>
                        <attribute id="ticket_id"/>
                    </attributes>
                </reconciliation>
                <uniqueness_rules>
                    <rule id="no_duplicate">
                        <attributes>
                            <attribute id="pnobject_id"/>
                            <attribute id="ticket_id"/>
                        </attributes>
                        <filter><![CDATA[]]></filter>
                        <disabled>false</disabled>
                        <is_blocking>true</is_blocking>
                    </rule>
                </uniqueness_rules>
            </properties>
            <fields>
                <field id="pnobject_id" xsi:type="AttributeExternalKey">
                    <sql>pnobject_id</sql>
                    <target_class>PNObject</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                    <jointype/>
                </field>
                <field id="ticket_id" xsi:type="AttributeExternalKey">
                    <sql>ticket_id</sql>
                    <target_class>Ticket</target_class>
                    <is_null_allowed>false</is_null_allowed>
                    <on_target_delete>DEL_AUTO</on_target_delete>
                </field>
                <field id="ticket_ref" xsi:type="AttributeExternalField">
                    <extkey_attcode>ticket_id</extkey_attcode>
                    <target_attcode>ref</target_attcode>
                </field>
                <field id="ticket_title" xsi:type="AttributeExternalField">
                    <extkey_attcode>ticket_id</extkey_attcode>
                    <target_attcode>title</target_attcode>
                </field>
            </fields>
            <methods/>
            <presentation>
                <details>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="ticket_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </details>
                <search>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="ticket_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </search>
                <list>
                    <items>
                        <item id="pnobject_id">
                            <rank>10</rank>
                        </item>
                        <item id="ticket_id">
                            <rank>20</rank>
                        </item>
                    </items>
                </list>
            </presentation>
        </class>
    </classes>
    <menus>
        <menu id="PNManagement" xsi:type="MenuGroup" _delta="define">
            <rank>32</rank>
            <style>
                <decoration_classes>fa-solid fa-phone</decoration_classes>
            </style>
        </menu>
    </menus>
    <user_rights>
        <groups>
            <group id="PNObject" _delta="define">
                <classes>
                    <class id="PNObject"/>
                </classes>
            </group>
            <group id="LnkToPNObject" _delta="define">
                <classes>
                    <class id="lnkContactToPNObject"/>
                    <class id="lnkDocToPNObject"/>
                    <class id="lnkPNObjectToTicket"/>
                </classes>
            </group>
        </groups>
        <profiles>
        </profiles>
    </user_rights>
</itop_design>
